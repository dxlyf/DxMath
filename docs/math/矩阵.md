åœ¨ 2D æˆ– 3D å›¾å½¢ä¸­ï¼Œ**çŸ©é˜µçš„ä¹˜æ³•é¡ºåº**å¯¹äºå˜æ¢çš„æœ€ç»ˆç»“æœéå¸¸å…³é”®ã€‚ä¸åŒé¡ºåºæ„å‘³ç€å®Œå…¨ä¸åŒçš„æ•ˆæœã€‚

---

## ä¸€ã€å¸¸è§çš„é¡ºåºï¼š**Scale â†’ Rotate â†’ Skew â†’ Translate**

è¿™æ˜¯**å¯¹è±¡ç©ºé—´ â†’ ä¸–ç•Œç©ºé—´**ï¼ˆObject â†’ Worldï¼‰çš„å…¸å‹å˜æ¢é¡ºåºï¼Œä¹Ÿå°±æ˜¯**å…ˆå±€éƒ¨ã€åå…¨å±€**ã€‚

çŸ©é˜µä¹˜æ³•æ˜¯å³ä¹˜çš„ï¼ˆåˆ—å‘é‡å½¢å¼ï¼‰ï¼š

```text
M = T * K * R * S
```

å¦‚æœä½ æœ‰ä¸€ä¸ªç‚¹ `v`ï¼Œåˆ™ï¼š

```text
v' = M * v = T * K * R * S * v
```

ä¹Ÿå°±æ˜¯ï¼š

1. **å…ˆç¼©æ”¾ Scale**
2. **å†æ—‹è½¬ Rotate**
3. **ç„¶åæ–œåˆ‡ Skew**
4. **æœ€åå¹³ç§» Translate**

---

## äºŒã€ä¸ºä»€ä¹ˆé¡ºåºé‡è¦ï¼Ÿ

å˜æ¢æ˜¯ä¾é™„åœ¨åæ ‡ç³»ä¸Šçš„ã€‚å¦‚æœä½ å…ˆå¹³ç§»å†æ—‹è½¬ï¼Œç‰©ä½“ä¼šç»•**ä¸–ç•ŒåŸç‚¹**æ—‹è½¬ï¼›ä½†å¦‚æœä½ å…ˆæ—‹è½¬å†å¹³ç§»ï¼Œç‰©ä½“ä¼šç»•**è‡ªèº«ä¸­å¿ƒ**æ—‹è½¬å¹¶å†è¢«å¹³ç§»ã€‚

---

## ä¸‰ã€æ¯ä¸ªçŸ©é˜µçš„å½¢å¼ï¼ˆ2D ç®€åŒ–ç‰ˆï¼‰

* **Scale (S)**ï¼š

  ```
  [ sx  0   0 ]
  [ 0   sy  0 ]
  [ 0   0   1 ]
  ```

* **Rotate (R)**ï¼š

  ```
  [ cosÎ¸  -sinÎ¸  0 ]
  [ sinÎ¸   cosÎ¸  0 ]
  [  0       0   1 ]
  ```

* **Skew (K)**ï¼ˆä»¥ x å’Œ y æ–¹å‘ä¸ºä¾‹ï¼‰ï¼š

  ```
  [ 1  tan(skewX)  0 ]
  [ tan(skewY)  1  0 ]
  [    0         0  1 ]
  ```

* **Translate (T)**ï¼š

  ```
  [ 1  0  tx ]
  [ 0  1  ty ]
  [ 0  0   1 ]
  ```

---

## å››ã€æ€»ç»“

å˜æ¢é¡ºåºå»ºè®®ï¼ˆä»å³åˆ°å·¦ï¼‰ï¼š

```
v' = T * K * R * S * v
```

å®é™…ä»£ç ä¸­ï¼Œæ¯”å¦‚åœ¨ Canvasã€WebGLã€OpenGLã€DirectXã€Skia ç­‰ä¸­ï¼š

* å¦‚æœæ˜¯**åˆ—å‘é‡**ï¼ˆé»˜è®¤å¤šæ•°å›¾å½¢å¼•æ“ï¼‰ï¼šä¹˜æ³•é¡ºåºæ˜¯ `M = T * R * S`
* å¦‚æœæ˜¯**è¡Œå‘é‡**ï¼šåˆ™ä¹˜æ³•é¡ºåºæ˜¯åçš„ `M = S * R * T`

---

å¦‚ä½ å‘Šè¯‰æˆ‘ä½ æ˜¯åœ¨å“ªä¸ªå¼•æ“ï¼ˆCanvas / WebGL / Three.js / Skia / Cairo / Unity / OpenGL ç­‰ï¼‰ä½¿ç”¨ï¼Œæˆ‘å¯ä»¥ç»™ä½ å®šåˆ¶é¡ºåºå’Œä»£ç ã€‚


å¥½çš„ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç”¨ TypeScript ç¼–å†™çš„ **åˆ—ä¸»åºï¼ˆcolumn-majorï¼‰** çš„ `Mat3`ï¼ˆ3x3 çŸ©é˜µï¼‰ç±»ï¼Œé€‚ç”¨äºå›¾å½¢å˜æ¢ä¸­å¸¸ç”¨çš„æ“ä½œï¼Œä¾‹å¦‚ `translate`ã€`scale`ã€`rotate`ã€`multiply`ã€`identity`ã€`invert`ã€`transformPoint` ç­‰ã€‚

---

### âœ… åˆ—ä¸»åºè¯´æ˜ï¼š

åœ¨åˆ—ä¸»åºä¸‹ï¼ŒçŸ©é˜µä»¥åˆ—ä¸ºå•ä½å­˜å‚¨ï¼š

```
[ m00 m01 m02 ]    ç¬¬0åˆ—: [ m00, m10, m20 ]
[ m10 m11 m12 ] => ç¬¬1åˆ—: [ m01, m11, m21 ]
[ m20 m21 m22 ]    ç¬¬2åˆ—: [ m02, m12, m22 ]
```

å³ï¼š

```ts
[
  m00, m10, m20,  // ç¬¬1åˆ—
  m01, m11, m21,  // ç¬¬2åˆ—
  m02, m12, m22,  // ç¬¬3åˆ—
]
```

---

### ğŸ“¦ TypeScript `Mat3` å®ç°ï¼š

```ts
type Vec2 = [number, number];

export class Mat3 {
  // åˆ—ä¸»åºå­˜å‚¨
  elements: Float32Array;

  constructor() {
    this.elements = new Float32Array(9);
    this.identity();
  }

  static identity(): Mat3 {
    return new Mat3().identity();
  }

  identity(): this {
    const e = this.elements;
    e[0] = 1; e[3] = 0; e[6] = 0;
    e[1] = 0; e[4] = 1; e[7] = 0;
    e[2] = 0; e[5] = 0; e[8] = 1;
    return this;
  }

  copyFrom(m: Mat3): this {
    this.elements.set(m.elements);
    return this;
  }

  clone(): Mat3 {
    const m = new Mat3();
    m.elements.set(this.elements);
    return m;
  }

  translate(tx: number, ty: number): this {
    const t = new Mat3();
    t.elements.set([
      1, 0, 0,
      0, 1, 0,
      tx, ty, 1
    ]);
    return this.multiply(t);
  }

  scale(sx: number, sy: number): this {
    const s = new Mat3();
    s.elements.set([
      sx, 0, 0,
      0, sy, 0,
      0, 0, 1
    ]);
    return this.multiply(s);
  }

  rotate(rad: number): this {
    const c = Math.cos(rad);
    const s = Math.sin(rad);
    const r = new Mat3();
    r.elements.set([
      c, s, 0,
     -s, c, 0,
      0, 0, 1
    ]);
    return this.multiply(r);
  }

  skew(sx: number, sy: number): this {
    const t = new Mat3();
    t.elements.set([
      1, Math.tan(sy), 0,
      Math.tan(sx), 1, 0,
      0, 0, 1
    ]);
    return this.multiply(t);
  }

  multiply(m: Mat3): this {
    const a = this.elements;
    const b = m.elements;
    const result = new Float32Array(9);

    for (let col = 0; col < 3; ++col) {
      for (let row = 0; row < 3; ++row) {
        result[col * 3 + row] =
          a[0 * 3 + row] * b[col * 3 + 0] +
          a[1 * 3 + row] * b[col * 3 + 1] +
          a[2 * 3 + row] * b[col * 3 + 2];
      }
    }

    this.elements = result;
    return this;
  }

  transformPoint(x: number, y: number): Vec2 {
    const e = this.elements;
    return [
      x * e[0] + y * e[3] + e[6],
      x * e[1] + y * e[4] + e[7],
    ];
  }

  invert(): this {
    const m = this.elements;
    const a00 = m[0], a01 = m[3], a02 = m[6];
    const a10 = m[1], a11 = m[4], a12 = m[7];
    const a20 = m[2], a21 = m[5], a22 = m[8];

    const b01 = a22 * a11 - a12 * a21;
    const b11 = -a22 * a10 + a12 * a20;
    const b21 = a21 * a10 - a11 * a20;

    let det = a00 * b01 + a01 * b11 + a02 * b21;
    if (!det) throw new Error("Matrix not invertible");

    det = 1.0 / det;

    const result = new Float32Array(9);
    result[0] = b01 * det;
    result[1] = (-a22 * a01 + a02 * a21) * det;
    result[2] = (a12 * a01 - a02 * a11) * det;
    result[3] = b11 * det;
    result[4] = (a22 * a00 - a02 * a20) * det;
    result[5] = (-a12 * a00 + a02 * a10) * det;
    result[6] = b21 * det;
    result[7] = (-a21 * a00 + a01 * a20) * det;
    result[8] = (a11 * a00 - a01 * a10) * det;

    this.elements = result;
    return this;
  }
}
```

---

### ğŸ“Œ ç¤ºä¾‹ç”¨æ³•ï¼š

```ts
const mat = new Mat3()
  .translate(100, 50)
  .rotate(Math.PI / 4)
  .scale(2, 2);

const point = mat.transformPoint(1, 1);
console.log(point); // åº”è¾“å‡ºå˜æ¢åçš„åæ ‡
```

---

å¦‚ä½ è¿˜éœ€è¦ï¼š

* å…¼å®¹ DOMMatrix / CanvasTransform
* æ”¯æŒ WebGL uniform ä¼ é€’ï¼ˆ`Float32Array`ï¼‰
* æ”¯æŒçŸ©é˜µè½¬ç½®ã€æ‹¼æ¥ SVG ç­‰

æˆ‘ä¹Ÿå¯ä»¥ç»§ç»­æ‰©å±•ã€‚æ˜¯å¦éœ€è¦åŠ å…¥ `fromDOMMatrix()`ã€`toString()`ã€`toCSS()`ã€æˆ– `setFromComponents()` ç­‰æ¥å£ï¼Ÿ




CSS ä¸­ä½¿ç”¨çš„å˜æ¢çŸ©é˜µæ˜¯ **åˆ—ä¸»åºï¼ˆcolumn-major orderï¼‰**ã€‚

---

## âœ… è¯æ®ï¼ˆCSS Transform æ˜¯åˆ—ä¸»åºï¼‰ï¼š

CSS ä¸­çš„ `transform` å±æ€§å¯ä»¥ä½¿ç”¨ `matrix(...)` æˆ– `matrix3d(...)` æ¥æŒ‡å®š 2D / 3D å˜æ¢çŸ©é˜µã€‚

### ç¤ºä¾‹ï¼š2D `matrix(a, b, c, d, e, f)` çš„å«ä¹‰æ˜¯ï¼š

è¿™æ˜¯ä¸€ä¸ª 3x3 çŸ©é˜µçš„å‰ 6 ä¸ªå…ƒç´ ï¼š

```
[ a  c  e ]
[ b  d  f ]
[ 0  0  1 ]
```

æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯åˆ—ä¸»åºæ’åˆ—çš„ï¼š

```ts
// åˆ—ä¸»åºçŸ©é˜µï¼š
[
  a, b, 0,  // ç¬¬ä¸€åˆ—
  c, d, 0,  // ç¬¬äºŒåˆ—
  e, f, 1   // ç¬¬ä¸‰åˆ—ï¼ˆå¹³ç§»ï¼‰
]
```

è¿™ä¸ OpenGL/WebGL çš„çº¦å®šä¸€è‡´ï¼Œæ˜¯ **åˆ—å‘é‡ Ã— çŸ©é˜µ** çš„æ–¹å¼ã€‚

---

## ğŸ” å¯¹æ¯”è¡Œä¸»åºï¼ˆä¾‹å¦‚æŸäº› C++ æ•°å­¦åº“ï¼‰ï¼š

* **åˆ—ä¸»åº**ï¼ˆCSSã€WebGLã€OpenGLï¼‰ï¼šçŸ©é˜µä¹˜æ³•æ˜¯ `M * v`ï¼Œå˜æ¢é¡ºåºæ˜¯ **å…ˆç¼©æ”¾å†æ—‹è½¬å†å¹³ç§»ï¼ˆå³ä¹˜ï¼‰**ã€‚
* **è¡Œä¸»åº**ï¼ˆDirectXã€æŸäº› C åº“ï¼‰ï¼šå˜æ¢é¡ºåºæ˜¯ä»å·¦å¾€å³ã€‚

---

## ğŸ” å°ç»“

| é¢†åŸŸ        | é¡ºåº  | ä¸»åºç±»å‹  |
| --------- | --- | ----- |
| CSS       | åˆ—å‘é‡ | âœ… åˆ—ä¸»åº |
| WebGL     | åˆ—å‘é‡ | âœ… åˆ—ä¸»åº |
| OpenGL    | åˆ—å‘é‡ | âœ… åˆ—ä¸»åº |
| DirectX   | è¡Œå‘é‡ | âŒ è¡Œä¸»åº |
| GLSLï¼ˆç€è‰²å™¨ï¼‰ | åˆ—å‘é‡ | âœ… åˆ—ä¸»åº |

---

## âœ… CSS ä¸­çŸ©é˜µå˜æ¢ä¸ JS å¯¹åº”å…³ç³»ï¼š

```js
const matrix = new DOMMatrix();
matrix.translateSelf(100, 50);
matrix.rotateSelf(45);
matrix.scaleSelf(2, 2);
console.log(matrix.toString()); // matrix(a, b, c, d, e, f)
```

å¯ä»¥ç›´æ¥æ˜ å°„åˆ° CSSï¼š

```css
transform: matrix(a, b, c, d, e, f);
```

---

å¦‚ä½ åœ¨å†™è‡ªå·±çš„çŸ©é˜µåº“ï¼Œç¡®ä¿ä½ çš„çŸ©é˜µä¸ CSS/WebGL ä¿æŒä¸€è‡´ï¼Œç”¨åˆ—ä¸»åºå³å¯ã€‚éœ€è¦æˆ‘æä¾›ä¸€ä¸ªå…¼å®¹ `DOMMatrix` æˆ– `CSS matrix()` çš„å¯¼å‡ºå‡½æ•°å—ï¼Ÿ
